# Important Defaults

> Tanstack Query의 기본 동작 이해하기

1. `useQuery`, `useInfiniteQuery`는 기본적으로 캐시된 데이터를 오래된 것으로 간주한다.
   1. 기본적으로 캐시 데이터는 오래된 상태로 간주해 새롭게 마운트되거나 앱이 포커스되면 자동으로 refetch를 트리거한다.
   2. 이 동작을 변경하려면 `staleTime` 옵션을 설정해야 한다.
      1. ex) `staleTime = 2*60*1000` 이면 2분동안 혹은 쿼리가 수동으로 무효화될 때까지 어떤 종료의 refetch도 일어나지 않고 캐시에서 데이터를 읽는다.
2. "stale"한 쿼리는 다음 상황에서 자동으로 refetch를 트리거 한다.
   1. 해당 쿼리 인스턴스가 새로 마운트될 때
   2. 윈도우/앱이 다시 포커스 될 때
   3. 네트워크가 다시 연결될 때
3. 쿼리는 선택적으로 `refetchInterval`로 구성해 `staleTime`과 별개로 정해진 시간마다 강제로 refetch를 트리거할 수 있다.
4. 사용되지 않는 쿼리 인스턴스는 "비활성" 상태로 전환된다.
   1. 기본적으로 5분 뒤 가비지 컬렉션, 이를 변경하려면 `gcTime` 값 변경
5. 쿼리가 실패할 경우 기본적으로 3번 재시도
6. 구조적 공유(Structural Sharing)기능으로 렌더링 성능 최적화

   1. 리액트 쿼리는 기본적으로 구조적으로 같은 데이터는 같은 참조를 유지한다

      ⇒ 불필요한 리렌더링을 막기 위해 기존 객체를 재사용하는 방식

      ⇒ `useMemo`, `useCallback`, `React.memo` 등의 최적화가 정확하게 작동한다.
